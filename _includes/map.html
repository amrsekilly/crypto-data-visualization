<div class="ui vertical masthead aligned segment" id="home-banner">
  <div class="ui wide">
    <!-- map section -->
    <div id='map'></div>
  </div>
</div>


<!-- map buttons section -->
<div class="ui segment">
  <div class="container">
    <div class="ui form">
      <form action="" class="inline fields">
        <div class="field">
          <div class="ui radio checkbox">
            <label>Bitcoin</label>
            <input type="radio" name="currency" checked="checked" value="bitcoin" onChange="changeCurrency()">
          </div>
        </div>
        <div class="field">
          <div class="ui radio checkbox">
            <label>Ethereum</label>
            <input type="radio" name="currency" value="ethereum" onChange="changeCurrency()">
          </div>
        </div>
        <div class="field">
          <div class="ui radio checkbox">
            <label>Litecoin</label>
            <input type="radio" name="currency" value="litecoin" onChange="changeCurrency()">
          </div>
        </div>
        <div class="field">
          <div class="ui radio checkbox">
            <label>Dash</label>
            <input type="radio" name="currency" value="dash" onChange="changeCurrency()">
          </div>
        </div>
        <div class="field">
          <div class="ui radio checkbox">
            <label>Ripple</label>
            <input type="radio" name="currency" value="ripple" onChange="changeCurrency()">
          </div>
        </div>
        <div class="field">
          <div class="ui radio checkbox">
            <label>Bitcoin Cash</label>
            <input type="radio" name="currency" value="bitcoinCash" onChange="changeCurrency()">
          </div>
        </div>
        
      </form>
    </div>
  </div>
</div>


<script>

  // import the cryptocurrency icons
  const bitcoin = "{{site.baseurl}}/images/icons/btc.png";
  const ethereum = "{{site.baseurl}}/images/icons/eth.png";
  const litecoin = "{{site.baseurl}}/images/icons/ltc.png";
  const bch = "{{site.baseurl}}/images/icons/bch.png";
  const btcz = "{{site.baseurl}}/images/icons/btcz.png";

  // MapBox's API key
  mapboxgl.accessToken = 'pk.eyJ1IjoiYW1yc2VraWxseSIsImEiOiJjamVzbWwxeTc3MWV6MzNvMTA4NnE1cGRqIn0.gduDJTnrg9nbXGLe0GSiIw';
  var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/amrsekilly/cjesn29l429772rphyzf63dbk'
  });

  // add the map controls 
  map.addControl(new mapboxgl.NavigationControl(), 'top-left');
  // disable map zoom when using scroll
  map.scrollZoom.disable();


  var geojson = {
      "type": "FeatureCollection",
      "features": [
      {
        "type": "Feature",
        "properties": {
          "logo": "https://i.imgur.com/2IVXVHL.png",
          "currencies": [bitcoin, litecoin, bch, btcz],
          "country": "Hong Kong",
          "description": "< 500 GB",
          "iconSize": 20
        },
        "geometry": {
          "type": "Point",
          "coordinates": [
            20.201469,
            9.712924
          ]
        }
      },
      {
        "type": "Feature",
        "properties": {
          "logo": "https://i.imgur.com/2IVXVHL.png",
          "currencies": [bitcoin, ethereum, bch, btcz],
          "country": "Hong Kong",
          "description": "< 500 GB",
          "iconSize": 10
        },
        "geometry": {
          "type": "Point",
          "coordinates": [
            40.201469,
            9.712924
          ]
        }
      },
      {
        "type": "Feature",
        "properties": {
          "logo": "https://i.imgur.com/2IVXVHL.png",
          "country": "Hong Kong",
          "currencies": [bitcoin, litecoin, ethereum, bch, btcz],
          "description": "< 1 TB",
          "iconSize": 30
        },
        "geometry": {
          "type": "Point",
          "coordinates": [
            -63.29223632812499,
            -18.28151823530889
          ]
        }
      },
      {
        "type": "Feature",
        "properties": {
          "logo": "https://i.imgur.com/2IVXVHL.png",
          "currencies": [bitcoin, ethereum, bch, btcz],
          "country": "Hong Kong",
          "description": "< 500 GB",
          "iconSize": 10
        },
        "geometry": {
          "type": "Point",
          "coordinates": [
            -53.29223632812499,
            -28.28151823530889
          ]
        }
      },
      {
        "type": "Feature",
        "properties": {
          "logo": "https://i.imgur.com/2IVXVHL.png",
          "currencies": [bitcoin, litecoin, ethereum, bch],
          "country": "Hong Kong",
          "description": "< 500 GB",
          "iconSize": 20
        },
        "geometry": {
          "type": "Point",
          "coordinates": [
            20.201469,
            19.712924
          ]
        }
      },
      {
        "type": "Feature",
        "properties": {
          "logo": "https://i.imgur.com/2IVXVHL.png",
          "currencies": [bitcoin, litecoin, ethereum, btcz],
          "country": "Hong Kong",
          "description": "< 500 GB",
          "iconSize": 20
        },
        "geometry": {
          "type": "Point",
          "coordinates": [
            49.902097,
            64.205112
          ]
        }
      },
      {
        "type": "Feature",
        "properties": {
          "logo": "https://i.imgur.com/2IVXVHL.png",
          "currencies": [bitcoin, litecoin, bch, btcz],
          "country": "Hong Kong",
          "description": "< 500 GB",
          "iconSize": 20
        },
        "geometry": {
          "type": "Point",
          "coordinates": [
            -96.324462890625,
            40.024695711685304
          ]
        }
      },
    ]
};

  // wait until the map is displayed
  map.on('load', function () {

    // Add a layer showing the places.
    map.addLayer({
      "id": "markers",
      "type": "symbol",
      "source": {
        "type": "geojson",
        "data": geojson
      }
    });

    // loop over the exchange centers 
    geojson.features.forEach(function (marker) {
      // create a DOM element for the marker
      var el = document.createElement('div');
      el.className = 'marker';
      el.style.backgroundColor = '#00FFBA';
      el.style.width = marker.properties.iconSize + 'px';
      el.style.height = marker.properties.iconSize + 'px';

      // add marker to map
      var m = new mapboxgl.Marker(el)
        .setLngLat(marker.geometry.coordinates)
        .setPopup(new mapboxgl.Popup({ 
          offset: 25, 
          closeButton: false
          }) // add popups
        .setHTML(`
          <img class="exchange-logo" src="${marker.properties.logo}" />
          <p class="exchange-country"> 
            ${marker.properties.country}
          </p>
          ${
            marker.properties.currencies
            .map(currency => `<span><img src="${currency}" /></span>`)
            .join('')
          }
        `))
        .addTo(map);
    });
  });

  // handle the currency changes
  function changeCurrency() {
    let currency = document.forms[0];
    for (var i = 0; i < currency.length; i++) {
      if (currency[i].checked) {
        console.log(currency[i].value);
      }
    }
  }


</script>